# AI Terminal User Guide

Welcome to AI Terminal! This guide documents the features and shortcuts available in the application.

## Features

### 1. Shell Integration & Markers
The terminal detects when commands start and finish (bash and zsh supported).
- **Markers**: A visual indicator appears in the gutter (left side) for every command.
  - **Grey**: Command is running.
  - **Green**: Command finished successfully (Exit Code 0).
  - **Red**: Command failed (Non-zero Exit Code).
- **Remote sessions**: By default inside AI Terminal, `ssh` is aliased to `aiterm_ssh` so markers are enabled automatically. To opt out for a single command, run `\ssh <host>` (backslash avoids the alias) or start a new tab and remove the alias. `aiterm_ssh` injects the shell integration on the remote side without leaving a permanent file. For non-interactive `ssh host command`, it falls back to plain `ssh` (single marker on the local command).
- **Remote bootstrap safety**: The SSH helper is sent as a base64 payload; if it fails to decode or validate, the session falls back to a normal login shell without markers.
- **Hide payload (optional)**: Set `AITERM_SSH_HIDE_PAYLOAD=1` to send the helper via SSH `SendEnv` instead of embedding it in the command line. This requires `AcceptEnv AITERM_B64` on the remote SSH server; otherwise markers will be disabled for that session.
- **Debugging hooks**: Set `AITERM_HOOK_DEBUG=1` before launching a shell to print which hook path is used (bash `PROMPT_COMMAND` array vs string, zsh hook install).

### 2. Smart Copy
You can easily copy commands and their outputs without manually selecting text.
- **Click a Marker**: Clicking on any command marker opens a "Copy Options" dialog.
  - **Copy Command Only**: Copies just the command text (e.g., `ls -la`).
  - **Copy Output Only**: Copies just the output generated by that command.
  - **Add to AI Context**: Add command/output to the AI Panel context.

### 3. AI Panel
The AI Panel provides context-aware assistance alongside the terminal.
- **Toggle**: Use the AI Panel button in the top bar.
- **Detach**: Pop the panel into its own window and reattach when needed.
- **Chat**: Send prompts and see responses stream in.
- **Markdown**: Responses render with links, tables, emphasis, and code blocks.
- **Copy Code**: Code blocks include a copy button.
- **Context Tab**: Staged context items can be previewed, removed, or cleared.
- **Capture Last N**: Capture the last N completed commands/outputs into context.
- **Selection Capture**: Select text in the terminal and click “Add Selection to Context.”

### 4. Font Zooming
Adjust the text size to your preference. The terminal window automatically reflows text when zooming.

### 5. Search
Find text within your terminal buffer.
- Press `Cmd + F` to open the search bar.
- Type to highlight matches.
- Press `Enter` for next match, `Shift + Enter` for previous.

### 6. Scrolling & Scrollbar
- Mouse wheel/trackpad scrolling is supported. A visible right-hand scrollbar overlay appears; you can click or drag it to move through the buffer.
- If system scrollbars are hidden (e.g., macOS auto-hide), the overlay ensures you still see position and can drag to scroll.

### 7. Clickable Links
URLs in the terminal are automatically detected.
- **Hover**: The link will be underlined.
- **Click**: Opens the link in your default browser.

### 8. Tabs
Manage multiple terminal sessions in a single window.
- **New Tab**: Press `Cmd + T` to open a new tab.
- **Close Tab**: Press `Cmd + W` or click the `×` icon on the tab.
- **Exit**: Typing `exit` in the shell will close the current tab.
- **Close App**: Closing the last tab will close the application.

## Keyboard Shortcuts

| Action | Shortcut (macOS) | Shortcut (Windows/Linux) |
|--------|------------------|--------------------------|
| **New Tab** | `Cmd` + `T` | `Ctrl` + `T` |
| **Close Tab** | `Cmd` + `W` | `Ctrl` + `W` |
| **Zoom In** | `Cmd` + `+` (or `=`) | `Ctrl` + `+` (or `=`) |
| **Zoom Out** | `Cmd` + `-` | `Ctrl` + `-` |
| **Reset Zoom** | `Cmd` + `0` | `Ctrl` + `0` |
| **Find** | `Cmd` + `F` | `Ctrl` + `F` |
| **Toggle AI Panel** | `Cmd` + `B` | `Ctrl` + `B` |
| **Open Settings** | `Cmd` + `,` | `Ctrl` + `,` |
| **Copy** | `Cmd` + `C` | `Ctrl` + `C` |
| **Paste** | `Cmd` + `V` | `Ctrl` + `V` |

## Configuration
The terminal creates a configuration directory at `~/.config/aiterminal/`.
- **`bash_init.sh`**: This script is automatically generated and sourced to provide the shell integration features.

## AI Settings
Open Settings → AI to configure providers and models.
- **Providers**: OpenAI, Anthropic, Gemini, Ollama.
- **Test Connection**: Validates credentials and populates model/embedding dropdowns.
- **Custom URL**: Override base API endpoints when needed.

## Troubleshooting
- **Markers not showing (local)?** Open a fresh tab so the helper re-sources; bash and zsh are supported.
- **Markers not showing (remote)?** Use `aiterm_ssh <user@host>` (or plain `ssh` is already aliased to it inside AI Terminal). If the remote blocks sourcing, bypass with `\ssh` to avoid the alias.
- **Copy not working?** The app uses the system clipboard. Ensure you have granted permission if prompted.
- **Scrollbar missing?** The app renders its own overlay. If you still don’t see it, ensure you’re in the terminal area and the buffer is longer than the viewport; try scrolling once to reveal it.
